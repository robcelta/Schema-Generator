# Security Headers Configuration
# Use this with your web server (Nginx, Apache, etc.)

# Content Security Policy (Enhanced)
add_header Content-Security-Policy "
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com https://pagead2.googlesyndication.com https://partner.googleadservices.com https://tpc.googlesyndication.com;
  style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com;
  img-src 'self' data: https: blob:;
  font-src 'self' data: https:;
  connect-src 'self' https://pagead2.googlesyndication.com;
  frame-src 'self' https://googleads.g.doubleclick.net https://tpc.googlesyndication.com;
  object-src 'none';
  base-uri 'self';
  form-action 'self';
  upgrade-insecure-requests;
" always;

# Prevent MIME type sniffing
add_header X-Content-Type-Options "nosniff" always;

# Prevent clickjacking
add_header X-Frame-Options "DENY" always;

# XSS Protection
add_header X-XSS-Protection "1; mode=block" always;

# Referrer Policy
add_header Referrer-Policy "strict-origin-when-cross-origin" always;

# Permissions Policy (Feature Policy)
add_header Permissions-Policy "
  geolocation=(),
  microphone=(),
  camera=(),
  payment=(),
  usb=(),
  magnetometer=(),
  gyroscope=(),
  accelerometer=()
" always;

# Strict Transport Security (HSTS)
add_header Strict-Transport-Security "max-age=31536000; includeSubDomains; preload" always;

# Expect-CT
add_header Expect-CT "max-age=86400, enforce" always;

# Remove server information
server_tokens off;

# Rate limiting (adjust as needed)
limit_req_zone $binary_remote_addr zone=api:10m rate=10r/m;
limit_req zone=api burst=20 nodelay;

# HTTPS enforcement
if ($scheme != "https") {
    return 301 https://$host$request_uri;
}